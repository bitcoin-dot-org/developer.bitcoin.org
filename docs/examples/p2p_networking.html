
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    
    <title>P2P Network &#8212; Bitcoin for Developers  documentation</title>

    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-4.3.1-dist/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinxbootstrap4.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/bootstrap-4.3.1-dist/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../_static/sphinxbootstrap4.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Glossary" href="../glossary.html" />
    <link rel="prev" title="Payment Processing" href="payment_processing.html" /> 
  </head><body>
  <nav class="navbar navbar-expand-md  fixed-top navbar-dark bg-dark flex-wrap">
    <button class="navbar-toggler ml-auto py-2" type="button" data-toggle="collapse" data-target="#exCollapsingNavbar2">
      &#9776;
    </button>
      <div class="navbar-collapse collapse" id="exCollapsingNavbar2">
           <a class="navbar-brand py-1" href="../index.html">
                  Bitcoin for Developers
          </a>
          <ul class="navbar-nav mr-auto">
          
          </ul>
          <div class="dropdown-divider d-block d-sm-none mb-4"></div>
             
<form class="form-inline" action="../search.html" method="get">
  <input type="text" name="q" class="form-control" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
      </div>

      <!--<div class="row hidden-sm-up">
          <div class="collapse navbar-toggleable-xs container" id="exCollapsingNavbar2">
              <div class="container">
             　　 <a class="navbar-brand" href="../index.html">
                      Bitcoin for Developers
                  </a>
              </div>
              <ul class="nav navbar-nav">
              </ul>
              <div class="dropdown-divider"></div>
              <div class="navbar-text">search<div>
              
<form class="form-inline" action="../search.html" method="get">
  <input type="text" name="q" class="form-control" placeholder="Search" />
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          </div>
      </div>-->
    </nav>
  </div>

    <div class="related d-flex justify-content-between bg-light flex-wrap" role="navigation" aria-label="related navigation">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="../index.html">Bitcoin for Developers  documentation</a></li>
                <li class="breadcrumb-item"><a href="index.html"
                       
                         accesskey="U"
                         class="active"
                       >Examples</a></li>
            <li class="breadcrumb-item active">P2P Network</li>
        </ol>
       <div>
          <div class="btn-group btn-group-sm" role="group" aria-label="Basic example">
               <a href="payment_processing.html" title="Previous Chapter: Payment Processing" class="btn btn-primary" role="botton" accesskey="P">
                   &laquo; Payment Processing
               </a>
               <a href="../glossary.html" title="Next Chapter: Glossary" class="btn btn-primary" role="botton" accesskey="N">
                   Glossary &raquo;
               </a>
           </div>
       </div>
    </div>

  <div class="main container-fluid">
    <div class="row"> 
      <div class="sphinxsidebar d-none d-md-block">
        <div class="sphinxsidebarwrapper">          
            <h4>Table Of Contents</h4>
            
            
              <div class="sidebartoctree">
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../devguide/index.html">Developer Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../devguide/block_chain.html">Block Chain</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../devguide/block_chain.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/block_chain.html#proof-of-work">Proof Of Work</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/block_chain.html#block-height-and-forking">Block Height And Forking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/block_chain.html#transaction-data">Transaction Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/block_chain.html#consensus-rule-changes">Consensus Rule Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/block_chain.html#detecting-forks">Detecting Forks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../devguide/transactions.html">Transactions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../devguide/transactions.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/transactions.html#p2pkh-script-validation">P2PKH Script Validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/transactions.html#p2sh-scripts">P2SH Scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/transactions.html#standard-transactions">Standard Transactions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../devguide/transactions.html#pay-to-public-key-hash-p2pkh">Pay To Public Key Hash (P2PKH)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/transactions.html#pay-to-script-hash-p2sh">Pay To Script Hash (P2SH)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/transactions.html#multisig">Multisig</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/transactions.html#pubkey">Pubkey</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/transactions.html#null-data">Null Data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/transactions.html#non-standard-transactions">Non-Standard Transactions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/transactions.html#signature-hash-types">Signature Hash Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/transactions.html#locktime-and-sequence-number">Locktime And Sequence Number</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/transactions.html#transaction-fees-and-change">Transaction Fees And Change</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/transactions.html#avoiding-key-reuse">Avoiding Key Reuse</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/transactions.html#transaction-malleability">Transaction Malleability</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../devguide/contracts.html">Contracts</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../devguide/contracts.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/contracts.html#escrow-and-arbitration">Escrow And Arbitration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/contracts.html#micropayment-channel">Micropayment Channel</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/contracts.html#coinjoin">CoinJoin</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../devguide/wallets.html">Wallets</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../devguide/wallets.html#introductions">Introductions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/wallets.html#wallet-programs">Wallet Programs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../devguide/wallets.html#full-service-wallets">Full-Service Wallets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/wallets.html#signing-only-wallets">Signing-Only Wallets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/wallets.html#distributing-only-wallets">Distributing-Only Wallets</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/wallets.html#wallet-files">Wallet Files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../devguide/wallets.html#private-key-formats">Private Key Formats</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/wallets.html#public-key-formats">Public Key Formats</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/wallets.html#hierarchical-deterministic-key-creation">Hierarchical Deterministic Key Creation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/wallets.html#loose-key-wallets">Loose-Key Wallets</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../devguide/payment_processing.html">Payment Processing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../devguide/payment_processing.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/payment_processing.html#pricing-orders">Pricing Orders</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/payment_processing.html#requesting-payments">Requesting Payments</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../devguide/payment_processing.html#plain-text">Plain Text</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/payment_processing.html#bitcoin-uri">bitcoin: URI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/payment_processing.html#qr-codes">QR Codes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/payment_processing.html#payment-protocol">Payment Protocol</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/payment_processing.html#verifying-payment">Verifying Payment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/payment_processing.html#issuing-refunds">Issuing Refunds</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/payment_processing.html#disbursing-income-limiting-forex-risk">Disbursing Income (Limiting Forex Risk)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../devguide/payment_processing.html#merge-avoidance">Merge Avoidance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/payment_processing.html#last-in-first-out-lifo">Last In, First Out (LIFO)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/payment_processing.html#first-in-first-out-fifo">First In, First Out (FIFO)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/payment_processing.html#rebilling-recurring-payments">Rebilling Recurring Payments</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../devguide/operating_modes.html">Operating Modes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../devguide/operating_modes.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/operating_modes.html#full-node">Full Node</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/operating_modes.html#simplified-payment-verification-spv">Simplified Payment Verification (SPV)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../devguide/operating_modes.html#potential-spv-weaknesses">Potential SPV Weaknesses</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/operating_modes.html#bloom-filters">Bloom Filters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/operating_modes.html#application-of-bloom-filters">Application Of Bloom Filters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/operating_modes.html#future-proposals">Future Proposals</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../devguide/p2p_network.html">P2P Network</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../devguide/p2p_network.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/p2p_network.html#peer-discovery">Peer Discovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/p2p_network.html#connecting-to-peers">Connecting To Peers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/p2p_network.html#initial-block-download">Initial Block Download</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../devguide/p2p_network.html#blocks-first">Blocks-First</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/p2p_network.html#headers-first">Headers-First</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/p2p_network.html#block-broadcasting">Block Broadcasting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../devguide/p2p_network.html#orphan-blocks">Orphan Blocks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/p2p_network.html#transaction-broadcasting">Transaction Broadcasting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../devguide/p2p_network.html#memory-pool">Memory Pool</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/p2p_network.html#misbehaving-nodes">Misbehaving Nodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/p2p_network.html#alerts">Alerts</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../devguide/mining.html">Mining</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../devguide/mining.html#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/mining.html#solo-mining">Solo Mining</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/mining.html#pool-mining">Pool Mining</a></li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/mining.html#block-prototypes">Block Prototypes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../devguide/mining.html#getwork-rpc">getwork RPC</a></li>
<li class="toctree-l4"><a class="reference internal" href="../devguide/mining.html#getblocktemplate-rpc">getblocktemplate RPC</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../devguide/mining.html#stratum">Stratum</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/intro.html">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/intro.html#not-a-specification">Not A Specification</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/block_chain.html">Block Chain</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/block_chain.html#block-headers">Block Headers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/block_chain.html#block-versions">Block Versions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/block_chain.html#merkle-trees">Merkle Trees</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/block_chain.html#target-nbits">Target nBits</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/block_chain.html#serialized-blocks">Serialized Blocks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/transactions.html">Transactions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/transactions.html#opcodes">OpCodes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/transactions.html#address-conversion">Address Conversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/transactions.html#raw-transaction-format">Raw Transaction Format</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/transactions.html#txin-a-transaction-input-non-coinbase">TxIn: A Transaction Input (Non-Coinbase)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/transactions.html#outpoint-the-specific-part-of-a-specific-output">Outpoint: The Specific Part Of A Specific Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/transactions.html#txout-a-transaction-output">TxOut: A Transaction Output</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/transactions.html#coinbase-input-the-input-of-the-first-transaction-in-a-block">Coinbase Input: The Input Of The First Transaction In A Block</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/wallets.html">Wallets</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/wallets.html#deterministic-wallet-formats">Deterministic Wallet Formats</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/wallets.html#type-1-single-chain-wallets">Type 1: Single Chain Wallets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/wallets.html#type-2-hierarchical-deterministic-hd-wallets">Type 2: Hierarchical Deterministic (HD) Wallets</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/p2p_networking.html">P2P Network</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/p2p_networking.html#constants-and-defaults">Constants And Defaults</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/p2p_networking.html#protocol-versions">Protocol Versions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/p2p_networking.html#message-headers">Message Headers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../reference/p2p_networking.html#data-messages">Data Messages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/p2p_networking.html#block">Block</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/p2p_networking.html#getblocks">GetBlocks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/p2p_networking.html#getdata">GetData</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/p2p_networking.html#getheaders">GetHeaders</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/p2p_networking.html#headers">Headers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/p2p_networking.html#inv">Inv</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/p2p_networking.html#mempool">MemPool</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/p2p_networking.html#merkleblock">MerkleBlock</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/p2p_networking.html#cmpctblock">CmpctBlock</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/p2p_networking.html#sendcmpct">SendCmpct</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/p2p_networking.html#getblocktxn">GetBlockTxn</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/p2p_networking.html#blocktxn">BlockTxn</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/p2p_networking.html#notfound">NotFound</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/p2p_networking.html#tx">Tx</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/p2p_networking.html#control-messages">Control Messages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/p2p_networking.html#addr">Addr</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/p2p_networking.html#alert">Alert</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/p2p_networking.html#feefilter">FeeFilter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/p2p_networking.html#filteradd">FilterAdd</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/p2p_networking.html#filterclear">FilterClear</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/p2p_networking.html#filterload">FilterLoad</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/p2p_networking.html#getaddr">GetAddr</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/p2p_networking.html#ping">Ping</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/p2p_networking.html#pong">Pong</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/p2p_networking.html#reject">Reject</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/p2p_networking.html#sendheaders">SendHeaders</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/p2p_networking.html#verack">VerAck</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/p2p_networking.html#version">Version</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../reference/rpc/index.html">RPC API Reference</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../reference/rpc/index.html#blockchain-rpcs">Blockchain RPCs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getbestblockhash.html">getbestblockhash</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getblock.html">getblock</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getblockchaininfo.html">getblockchaininfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getblockcount.html">getblockcount</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getblockhash.html">getblockhash</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getblockheader.html">getblockheader</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getblockstats.html">getblockstats</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getchaintips.html">getchaintips</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getchaintxstats.html">getchaintxstats</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getdifficulty.html">getdifficulty</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getmempoolancestors.html">getmempoolancestors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getmempooldescendants.html">getmempooldescendants</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getmempoolentry.html">getmempoolentry</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getmempoolinfo.html">getmempoolinfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getrawmempool.html">getrawmempool</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/gettxout.html">gettxout</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/gettxoutproof.html">gettxoutproof</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/gettxoutsetinfo.html">gettxoutsetinfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/preciousblock.html">preciousblock</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/pruneblockchain.html">pruneblockchain</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/savemempool.html">savemempool</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/scantxoutset.html">scantxoutset</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/verifychain.html">verifychain</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/verifytxoutproof.html">verifytxoutproof</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rpc/index.html#control-rpcs">Control RPCs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getmemoryinfo.html">getmemoryinfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getrpcinfo.html">getrpcinfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/help.html">help</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/logging.html">logging</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/stop.html">stop</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/uptime.html">uptime</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rpc/index.html#generating-rpcs">Generating RPCs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/generate.html">generate</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/generatetoaddress.html">generatetoaddress</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rpc/index.html#mining-rpcs">Mining RPCs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getblocktemplate.html">getblocktemplate</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getmininginfo.html">getmininginfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getnetworkhashps.html">getnetworkhashps</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/prioritisetransaction.html">prioritisetransaction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/submitblock.html">submitblock</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/submitheader.html">submitheader</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rpc/index.html#network-rpcs">Network RPCs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/addnode.html">addnode</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/clearbanned.html">clearbanned</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/disconnectnode.html">disconnectnode</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getaddednodeinfo.html">getaddednodeinfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getconnectioncount.html">getconnectioncount</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getnettotals.html">getnettotals</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getnetworkinfo.html">getnetworkinfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getnodeaddresses.html">getnodeaddresses</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getpeerinfo.html">getpeerinfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/listbanned.html">listbanned</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/ping.html">ping</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/setban.html">setban</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/setnetworkactive.html">setnetworkactive</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rpc/index.html#rawtransactions-rpcs">Rawtransactions RPCs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/analyzepsbt.html">analyzepsbt</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/combinepsbt.html">combinepsbt</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/combinerawtransaction.html">combinerawtransaction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/converttopsbt.html">converttopsbt</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/createpsbt.html">createpsbt</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/createrawtransaction.html">createrawtransaction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/decodepsbt.html">decodepsbt</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/decoderawtransaction.html">decoderawtransaction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/decodescript.html">decodescript</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/finalizepsbt.html">finalizepsbt</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/fundrawtransaction.html">fundrawtransaction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getrawtransaction.html">getrawtransaction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/joinpsbts.html">joinpsbts</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/sendrawtransaction.html">sendrawtransaction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/signrawtransactionwithkey.html">signrawtransactionwithkey</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/testmempoolaccept.html">testmempoolaccept</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/utxoupdatepsbt.html">utxoupdatepsbt</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rpc/index.html#util-rpcs">Util RPCs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/createmultisig.html">createmultisig</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/deriveaddresses.html">deriveaddresses</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/estimatesmartfee.html">estimatesmartfee</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getdescriptorinfo.html">getdescriptorinfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/signmessagewithprivkey.html">signmessagewithprivkey</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/validateaddress.html">validateaddress</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/verifymessage.html">verifymessage</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../reference/rpc/index.html#wallet-rpcs">Wallet RPCs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/abandontransaction.html">abandontransaction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/abortrescan.html">abortrescan</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/addmultisigaddress.html">addmultisigaddress</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/backupwallet.html">backupwallet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/bumpfee.html">bumpfee</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/createwallet.html">createwallet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/dumpprivkey.html">dumpprivkey</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/dumpwallet.html">dumpwallet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/encryptwallet.html">encryptwallet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getaddressesbylabel.html">getaddressesbylabel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getaddressinfo.html">getaddressinfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getbalance.html">getbalance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getnewaddress.html">getnewaddress</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getrawchangeaddress.html">getrawchangeaddress</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getreceivedbyaddress.html">getreceivedbyaddress</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getreceivedbylabel.html">getreceivedbylabel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/gettransaction.html">gettransaction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getunconfirmedbalance.html">getunconfirmedbalance</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/getwalletinfo.html">getwalletinfo</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/importaddress.html">importaddress</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/importmulti.html">importmulti</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/importprivkey.html">importprivkey</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/importprunedfunds.html">importprunedfunds</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/importpubkey.html">importpubkey</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/importwallet.html">importwallet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/keypoolrefill.html">keypoolrefill</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/listaddressgroupings.html">listaddressgroupings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/listlabels.html">listlabels</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/listlockunspent.html">listlockunspent</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/listreceivedbyaddress.html">listreceivedbyaddress</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/listreceivedbylabel.html">listreceivedbylabel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/listsinceblock.html">listsinceblock</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/listtransactions.html">listtransactions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/listunspent.html">listunspent</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/listwalletdir.html">listwalletdir</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/listwallets.html">listwallets</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/loadwallet.html">loadwallet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/lockunspent.html">lockunspent</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/removeprunedfunds.html">removeprunedfunds</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/rescanblockchain.html">rescanblockchain</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/sendmany.html">sendmany</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/sendtoaddress.html">sendtoaddress</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/sethdseed.html">sethdseed</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/setlabel.html">setlabel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/settxfee.html">settxfee</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/signmessage.html">signmessage</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/signrawtransactionwithwallet.html">signrawtransactionwithwallet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/unloadwallet.html">unloadwallet</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/walletcreatefundedpsbt.html">walletcreatefundedpsbt</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/walletlock.html">walletlock</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/walletpassphrase.html">walletpassphrase</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/walletpassphrasechange.html">walletpassphrasechange</a></li>
<li class="toctree-l4"><a class="reference internal" href="../reference/rpc/walletprocesspsbt.html">walletprocesspsbt</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">Testing Applications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="testing.html#testnet">Testnet</a></li>
<li class="toctree-l3"><a class="reference internal" href="testing.html#regtest-mode">Regtest Mode</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="transactions.html">Transactions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="transactions.html#transaction-tutorial">Transaction Tutorial</a><ul>
<li class="toctree-l4"><a class="reference internal" href="transactions.html#simple-spending">Simple Spending</a></li>
<li class="toctree-l4"><a class="reference internal" href="transactions.html#simple-raw-transaction">Simple Raw Transaction</a></li>
<li class="toctree-l4"><a class="reference internal" href="transactions.html#complex-raw-transaction">Complex Raw Transaction</a></li>
<li class="toctree-l4"><a class="reference internal" href="transactions.html#offline-signing">Offline Signing</a></li>
<li class="toctree-l4"><a class="reference internal" href="transactions.html#p2sh-multisig">P2SH Multisig</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="payment_processing.html">Payment Processing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="payment_processing.html#payment-protocol">Payment Protocol</a><ul>
<li class="toctree-l4"><a class="reference internal" href="payment_processing.html#paymentrequest-paymentdetails">PaymentRequest &amp; PaymentDetails</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">P2P Network</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-bloom-filter">Creating A Bloom Filter</a></li>
<li class="toctree-l3"><a class="reference internal" href="#evaluating-a-bloom-filter">Evaluating A Bloom Filter</a></li>
<li class="toctree-l3"><a class="reference internal" href="#retrieving-a-merkleblock">Retrieving A MerkleBlock</a></li>
<li class="toctree-l3"><a class="reference internal" href="#parsing-a-merkleblock">Parsing A MerkleBlock</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

              </div>
            
          
  <h4>Previous topic</h4>
  <p class="topless"><a href="payment_processing.html"
                        title="previous chapter">Payment Processing</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../glossary.html"
                        title="next chapter">Glossary</a></p>
<div id="searchbox" style="display: none">
    <form class="form search" action="../search.html" method="get">
      <input type="text" name="q" class="form-control" placeholder="Search..." />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>

<script type="text/javascript">$('#searchbox').show(0);</script>
  <ul class="this-page-menu list-unstyled text-right">
    <li><a href="../_sources/examples/p2p_networking.rst.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
        </div>
      </div> 

      <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="p2p-network">
<h1>P2P Network<a class="headerlink" href="#p2p-network" title="Permalink to this headline">¶</a></h1>
<div class="section" id="creating-a-bloom-filter">
<h2>Creating A Bloom Filter<a class="headerlink" href="#creating-a-bloom-filter" title="Permalink to this headline">¶</a></h2>
<p>In this section, we’ll use variable names that correspond to the field names in the <code class="docutils literal notranslate"><span class="pre">`filterload</span></code> message documentation &lt;/en/developer-reference#filterclear&gt;`__. Each code block precedes the paragraph describing it.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="n">BYTES_MAX</span> <span class="o">=</span> <span class="mi">36000</span>
<span class="n">FUNCS_MAX</span> <span class="o">=</span> <span class="mi">50</span>

<span class="n">nFlags</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
<p>We start by setting some maximum values defined in <a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki">BIP37</a>: the maximum number of bytes allowed in a filter and the maximum number of hash functions used to hash each piece of data. We also set nFlags to zero, indicating we don’t want the remote node to update the filter for us. (We won’t use nFlags again in the sample program, but real programs will need to use it.)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">p</span> <span class="o">=</span> <span class="mf">0.0001</span>
</pre></div>
</div>
<p>We define the number (n) of elements we plan to insert into the filter and the false positive rate (p) we want to help protect our privacy. For this example, we will set <em>n</em> to one element and <em>p</em> to a rate of 1-in-10,000 to produce a small and precise filter for illustration purposes. In actual use, your filters will probably be much larger.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">log</span>
<span class="n">nFilterBytes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="o">/</span> <span class="mi">8</span><span class="p">,</span> <span class="n">BYTES_MAX</span><span class="p">))</span>
<span class="n">nHashFuncs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">nFilterBytes</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">/</span> <span class="n">n</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">FUNCS_MAX</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">bitarray</span> <span class="kn">import</span> <span class="n">bitarray</span>  <span class="c1"># from pypi.python.org/pypi/bitarray</span>
<span class="n">vData</span> <span class="o">=</span> <span class="n">nFilterBytes</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">bitarray</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="n">endian</span><span class="o">=</span><span class="s2">&quot;little&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Using the formula described in <a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki">BIP37</a>, we calculate the ideal size of the filter (in bytes) and the ideal number of hash functions to use. Both are truncated down to the nearest whole number and both are also constrained to the maximum values we defined earlier. The results of this particular fixed computation are 2 filter bytes and 11 hash functions. We then use <em>nFilterBytes</em> to create a little-endian bit array of the appropriate size.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nTweak</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
<p>We also should choose a value for <em>nTweak</em>. In this case, we’ll simply use zero.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyhash</span>  <span class="c1"># from https://github.com/flier/pyfasthash</span>
<span class="n">murmur3</span> <span class="o">=</span> <span class="n">pyhash</span><span class="o">.</span><span class="n">murmur3_32</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">bloom_hash</span><span class="p">(</span><span class="n">nHashNum</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="p">(</span><span class="n">nHashNum</span> <span class="o">*</span> <span class="mh">0xfba4c795</span> <span class="o">+</span> <span class="n">nTweak</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span>
    <span class="k">return</span><span class="p">(</span> <span class="n">murmur3</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">nFilterBytes</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
<p>We setup our hash function template using the formula and 0xfba4c795 constant set in <a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki">BIP37</a>. Note that we limit the size of the seed to four bytes and that we’re returning the result of the hash modulo the size of the filter in bits.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data_to_hash</span> <span class="o">=</span> <span class="s2">&quot;019f5b01d4195ecbc9398fbf3c3b1fa9&quot;</span> \
               <span class="o">+</span> <span class="s2">&quot;bb3183301d7a1fb3bd174fcfa40a2b65&quot;</span>
<span class="n">data_to_hash</span> <span class="o">=</span> <span class="n">data_to_hash</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;hex&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>For the data to add to the filter, we’re adding a TXID. Note that the TXID is in internal byte order.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">print</span> <span class="s2">&quot;                             Filter (As Bits)&quot;</span>
<span class="k">print</span> <span class="s2">&quot;nHashNum   nIndex   Filter   0123456789abcdef&quot;</span>
<span class="k">print</span> <span class="s2">&quot;~~~~~~~~   ~~~~~~   ~~~~~~   ~~~~~~~~~~~~~~~~&quot;</span>
<span class="k">for</span> <span class="n">nHashNum</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nHashFuncs</span><span class="p">):</span>
    <span class="n">nIndex</span> <span class="o">=</span> <span class="n">bloom_hash</span><span class="p">(</span><span class="n">nHashNum</span><span class="p">,</span> <span class="n">data_to_hash</span><span class="p">)</span>

    <span class="c1">## Set the bit at nIndex to 1</span>
    <span class="n">vData</span><span class="p">[</span><span class="n">nIndex</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="c1">## Debug: print current state</span>
    <span class="k">print</span> <span class="s1">&#39;      {0:2}      {1:2}     {2}   {3}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">nHashNum</span><span class="p">,</span>
        <span class="nb">hex</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nIndex</span><span class="p">)),</span>
        <span class="n">vData</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;hex&quot;</span><span class="p">),</span>
        <span class="n">vData</span><span class="o">.</span><span class="n">to01</span><span class="p">()</span>
    <span class="p">)</span>

<span class="k">print</span>
<span class="k">print</span> <span class="s2">&quot;Bloom filter:&quot;</span><span class="p">,</span> <span class="n">vData</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;hex&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we use the hash function template to run a slightly different hash function for <em>nHashFuncs</em> times. The result of each function being run on the transaction is used as an index number: the bit at that index is set to 1. We can see this in the printed debugging output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>                             Filter (As Bits)
nHashNum   nIndex   Filter   0123456789abcdef
~~~~~~~~   ~~~~~~   ~~~~~~   ~~~~~~~~~~~~~~~~
       0      0x7     8000   0000000100000000
       1      0x9     8002   0000000101000000
       2      0xa     8006   0000000101100000
       3      0x2     8406   0010000101100000
       4      0xb     840e   0010000101110000
       5      0x5     a40e   0010010101110000
       6      0x0     a50e   1010010101110000
       7      0x8     a50f   1010010111110000
       8      0x5     a50f   1010010111110000
       9      0x8     a50f   1010010111110000
      10      0x4     b50f   1010110111110000

Bloom filter: b50f
</pre></div>
</div>
<p>Notice that in iterations 8 and 9, the filter did not change because the corresponding bit was already set in a previous iteration (5 and 7, respectively). This is a normal part of bloom filter operation.</p>
<p>We only added one element to the filter above, but we could repeat the process with additional elements and continue to add them to the same filter. (To maintain the same false-positive rate, you would need a larger filter size as computed earlier.)</p>
<p>Note: for a more optimized Python implementation with fewer external dependencies, see <a class="reference external" href="https://github.com/petertodd/python-bitcoinlib">python-bitcoinlib’s</a> bloom filter module which is based directly on Bitcoin Core’s C++ implementation.</p>
<p>Using the <a class="reference external" href="/en/developer-reference#filterclear">“filterload” message</a> format, the complete filter created above would be the binary form of the annotated hexdump shown below:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>02 ......... Filter bytes: 2
b50f ....... Filter: 1010 1101 1111 0000
0b000000 ... nHashFuncs: 11
00000000 ... nTweak: 0/none
00 ......... nFlags: BLOOM_UPDATE_NONE
</pre></div>
</div>
</div>
<div class="section" id="evaluating-a-bloom-filter">
<h2>Evaluating A Bloom Filter<a class="headerlink" href="#evaluating-a-bloom-filter" title="Permalink to this headline">¶</a></h2>
<p>Using a bloom filter to find matching data is nearly identical to constructing a bloom filter—except that at each step we check to see if the calculated index bit is set in the existing filter.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">vData</span> <span class="o">=</span> <span class="n">bitarray</span><span class="p">(</span><span class="n">endian</span><span class="o">=</span><span class="s1">&#39;little&#39;</span><span class="p">)</span>
<span class="n">vData</span><span class="o">.</span><span class="n">frombytes</span><span class="p">(</span><span class="s2">&quot;b50f&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;hex&quot;</span><span class="p">))</span>
<span class="n">nHashFuncs</span> <span class="o">=</span> <span class="mi">11</span>
<span class="n">nTweak</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">nFlags</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Using the bloom filter created above, we import its various parameters. Note, as indicated in the section above, we won’t actually use <em>nFlags</em> to update the filter.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">contains</span><span class="p">(</span><span class="n">nHashFuncs</span><span class="p">,</span> <span class="n">data_to_hash</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">nHashNum</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nHashFuncs</span><span class="p">):</span>
        <span class="c1">## bloom_hash as defined in previous section</span>
        <span class="n">nIndex</span> <span class="o">=</span> <span class="n">bloom_hash</span><span class="p">(</span><span class="n">nHashNum</span><span class="p">,</span> <span class="n">data_to_hash</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">vData</span><span class="p">[</span><span class="n">nIndex</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;MATCH FAILURE: Index {0} not set in {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">hex</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">nIndex</span><span class="p">)),</span>
                <span class="n">vData</span><span class="o">.</span><span class="n">to01</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
</pre></div>
</div>
<p>We define a function to check an element against the provided filter. When checking whether the filter might contain an element, we test to see whether a particular bit in the filter is already set to 1 (if it isn’t, the match fails).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">## Test 1: Same TXID as previously added to filter</span>
<span class="n">data_to_hash</span> <span class="o">=</span> <span class="s2">&quot;019f5b01d4195ecbc9398fbf3c3b1fa9&quot;</span> \
               <span class="o">+</span> <span class="s2">&quot;bb3183301d7a1fb3bd174fcfa40a2b65&quot;</span>
<span class="n">data_to_hash</span> <span class="o">=</span> <span class="n">data_to_hash</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;hex&quot;</span><span class="p">)</span>
<span class="n">contains</span><span class="p">(</span><span class="n">nHashFuncs</span><span class="p">,</span> <span class="n">data_to_hash</span><span class="p">)</span>
</pre></div>
</div>
<p>Testing the filter against the data element we previously added, we get no output (indicating a possible match). Recall that bloom filters have a zero false negative rate—so they should always match the inserted elements.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">## Test 2: Arbitrary string</span>
<span class="n">data_to_hash</span> <span class="o">=</span> <span class="s2">&quot;1/10,000 chance this ASCII string will match&quot;</span>
<span class="n">contains</span><span class="p">(</span><span class="n">nHashFuncs</span><span class="p">,</span> <span class="n">data_to_hash</span><span class="p">)</span>
</pre></div>
</div>
<p>Testing the filter against an arbitrary element, we get the failure output below. Note: we created the filter with a 1-in-10,000 false positive rate (which was rounded up somewhat when we truncated), so it was possible this arbitrary string would’ve matched the filter anyway. It is not possible to set a bloom filter to a false positive rate of zero, so your program will always have to deal with false positives. The output below shows us that one of the hash functions returned an index number of 0x06, but that bit wasn’t set in the filter, causing the match failure:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>MATCH FAILURE: Index 0x6 not set in 1010110111110000
</pre></div>
</div>
</div>
<div class="section" id="retrieving-a-merkleblock">
<h2>Retrieving A MerkleBlock<a class="headerlink" href="#retrieving-a-merkleblock" title="Permalink to this headline">¶</a></h2>
<p>For the <a class="reference external" href="/en/developer-reference#merkleblock">“merkleblock” message</a> documentation on the reference page, an actual merkle block was retrieved from the <a class="reference external" href="/en/developer-guide#term-network">network</a> and manually processed. This section walks through each step of the process, demonstrating basic <a class="reference external" href="/en/developer-guide#term-network">network</a> communication and merkle block processing.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">sha256</span>
<span class="kn">import</span> <span class="nn">struct</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">network_string</span> <span class="o">=</span> <span class="s2">&quot;f9beb4d9&quot;</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;hex&quot;</span><span class="p">)</span>  <span class="c1"># Mainnet</span>

<span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span><span class="n">payload</span><span class="p">):</span>
    <span class="c1">## Command is ASCII text, null padded to 12 bytes</span>
    <span class="n">command</span> <span class="o">=</span> <span class="n">msg</span> <span class="o">+</span> <span class="p">(</span> <span class="p">(</span> <span class="mi">12</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="p">)</span> <span class="o">*</span> <span class="s2">&quot;</span><span class="se">\00</span><span class="s2">&quot;</span> <span class="p">)</span>

    <span class="c1">## Payload length is a uint32_t</span>
    <span class="n">payload_raw</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;hex&quot;</span><span class="p">)</span>
    <span class="n">payload_len</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">payload_raw</span><span class="p">))</span>

    <span class="c1">## Checksum is first 4 bytes of SHA256(SHA256(&lt;payload&gt;))</span>
    <span class="n">checksum</span> <span class="o">=</span> <span class="n">sha256</span><span class="p">(</span><span class="n">sha256</span><span class="p">(</span><span class="n">payload_raw</span><span class="p">)</span><span class="o">.</span><span class="n">digest</span><span class="p">())</span><span class="o">.</span><span class="n">digest</span><span class="p">()[:</span><span class="mi">4</span><span class="p">]</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
        <span class="n">network_string</span>
        <span class="o">+</span> <span class="n">command</span>
        <span class="o">+</span> <span class="n">payload_len</span>
        <span class="o">+</span> <span class="n">checksum</span>
        <span class="o">+</span> <span class="n">payload_raw</span>
    <span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</pre></div>
</div>
<p>To connect to the P2P <a class="reference external" href="/en/developer-guide#term-network">network</a>, the trivial Python function above was developed to compute message headers and send payloads decoded from hex.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">## Create a version message</span>
<span class="n">send</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">,</span>
      <span class="s2">&quot;71110100&quot;</span> <span class="c1"># ........................ Protocol Version: 70001</span>
    <span class="o">+</span> <span class="s2">&quot;0000000000000000&quot;</span> <span class="c1"># ................ Services: Headers Only (SPV)</span>
    <span class="o">+</span> <span class="s2">&quot;c6925e5400000000&quot;</span> <span class="c1"># ................ Time: 1415484102</span>
    <span class="o">+</span> <span class="s2">&quot;00000000000000000000000000000000&quot;</span>
    <span class="o">+</span> <span class="s2">&quot;0000ffff7f000001208d&quot;</span> <span class="c1"># ............ Receiver IP Address/Port</span>
    <span class="o">+</span> <span class="s2">&quot;00000000000000000000000000000000&quot;</span>
    <span class="o">+</span> <span class="s2">&quot;0000ffff7f000001208d&quot;</span> <span class="c1"># ............ Sender IP Address/Port</span>
    <span class="o">+</span> <span class="s2">&quot;0000000000000000&quot;</span> <span class="c1"># ................ Nonce (not used here)</span>
    <span class="o">+</span> <span class="s2">&quot;1b&quot;</span> <span class="c1"># .............................. Bytes in version string</span>
    <span class="o">+</span> <span class="s2">&quot;2f426974636f696e2e6f726720457861&quot;</span>
    <span class="o">+</span> <span class="s2">&quot;6d706c653a302e392e332f&quot;</span> <span class="c1"># .......... Version string</span>
    <span class="o">+</span> <span class="s2">&quot;93050500&quot;</span> <span class="c1"># ........................ Starting block height: 329107</span>
    <span class="o">+</span> <span class="s2">&quot;00&quot;</span> <span class="c1"># .............................. Relay transactions: false</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Peers on the <a class="reference external" href="/en/developer-guide#term-network">network</a> will not accept any requests until you send them a <a class="reference external" href="/en/developer-reference#version">“version” message</a>. The receiving node will reply with their <a class="reference external" href="/en/developer-reference#version">“version” message</a> and a <a class="reference external" href="/en/developer-reference#verack">“verack” message</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">send</span><span class="p">(</span><span class="s2">&quot;verack&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We’re not going to validate their <a class="reference external" href="/en/developer-reference#version">“version” message</a> with this simple script, but we will sleep a short bit and send back our own <a class="reference external" href="/en/developer-reference#verack">“verack” message</a> as if we had accepted their <a class="reference external" href="/en/developer-reference#version">“version” message</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;filterload&quot;</span><span class="p">,</span>
      <span class="s2">&quot;02&quot;</span>  <span class="c1"># ........ Filter bytes: 2</span>
    <span class="o">+</span> <span class="s2">&quot;b50f&quot;</span> <span class="c1"># ....... Filter: 1010 1101 1111 0000</span>
    <span class="o">+</span> <span class="s2">&quot;0b000000&quot;</span> <span class="c1"># ... nHashFuncs: 11</span>
    <span class="o">+</span> <span class="s2">&quot;00000000&quot;</span> <span class="c1"># ... nTweak: 0/none</span>
    <span class="o">+</span> <span class="s2">&quot;00&quot;</span> <span class="c1"># ......... nFlags: BLOOM_UPDATE_NONE</span>
<span class="p">)</span>
</pre></div>
</div>
<p>We set a bloom filter with the <a class="reference external" href="/en/developer-reference#filterclear">“filterload” message</a>. This filter is described in the two preceeding sections.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;getdata&quot;</span><span class="p">,</span>
      <span class="s2">&quot;01&quot;</span> <span class="c1"># ................................. Number of inventories: 1</span>
    <span class="o">+</span> <span class="s2">&quot;03000000&quot;</span> <span class="c1"># ........................... Inventory type: filtered block</span>
    <span class="o">+</span> <span class="s2">&quot;a4deb66c0d726b0aefb03ed51be407fb&quot;</span>
    <span class="o">+</span> <span class="s2">&quot;ad7331c6e8f9eef231b7000000000000&quot;</span> <span class="c1"># ... Block header hash</span>
<span class="p">)</span>
</pre></div>
</div>
<p>We request a merkle block for transactions matching our filter, completing our script.</p>
<p>To run the script, we simply pipe it to the Unix <code class="docutils literal notranslate"><span class="pre">`netcat</span></code> command &lt;<a class="reference external" href="https://en.wikipedia.org/wiki/Netcat">https://en.wikipedia.org/wiki/Netcat</a>&gt;`__ or one of its many clones, one of which is available for practically any platform. For example, with the original netcat and using hexdump (<code class="docutils literal notranslate"><span class="pre">hd</span></code>) to display the output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">## Connect to the Bitcoin Core peer running on localhost</span>
python get-merkle.py <span class="p">|</span> nc localhost <span class="m">8333</span> <span class="p">|</span> hd
</pre></div>
</div>
<p>Part of the response is shown in the section below.</p>
</div>
<div class="section" id="parsing-a-merkleblock">
<h2>Parsing A MerkleBlock<a class="headerlink" href="#parsing-a-merkleblock" title="Permalink to this headline">¶</a></h2>
<p>In the section above, we retrieved a merkle block from the <a class="reference external" href="/en/developer-guide#term-network">network</a>; now we will parse it. Most of the block header has been omitted. For a more complete hexdump, see the example in the <code class="docutils literal notranslate"><span class="pre">`merkleblock</span></code> message section &lt;/en/developer-reference#merkleblock&gt;`__.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>7f16c5962e8bd963659c793ce370d95f
093bc7e367117b3c30c1f8fdd0d97287 ... Merkle root

07000000 ........................... Transaction count: 7
04 ................................. Hash count: 4

3612262624047ee87660be1a707519a4
43b1c1ce3d248cbfc6c15870f6c5daa2 ... Hash #1
019f5b01d4195ecbc9398fbf3c3b1fa9
bb3183301d7a1fb3bd174fcfa40a2b65 ... Hash #2
41ed70551dd7e841883ab8f0b16bf041
76b7d1480e4f0af9f3d4c3595768d068 ... Hash #3
20d2a7bc994987302e5b1ac80fc425fe
25f8b63169ea78e68fbaaefa59379bbf ... Hash #4

01 ................................. Flag bytes: 1
1d ................................. Flags: 1 0 1 1 1 0 0 0
</pre></div>
</div>
<p>We parse the above <a class="reference external" href="/en/developer-reference#merkleblock">“merkleblock” message</a> using the following instructions. Each illustration is described in the paragraph below it.</p>
<div class="figure align-center" id="id1">
<img alt="Parsing A MerkleBlock" src="../_images/en-merkleblock-parsing-001.svg" /><p class="caption"><span class="caption-text">Parsing A MerkleBlock</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<p>We start by building the structure of a merkle tree based on the number of transactions in the block.</p>
<div class="figure align-center" id="id2">
<img alt="Parsing A MerkleBlock" src="../_images/en-merkleblock-parsing-002.svg" /><p class="caption"><span class="caption-text">Parsing A MerkleBlock</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<p>The first flag is a 1 and the merkle root is (as always) a non-TXID node, so we will need to compute the hash later based on this node’s children. Accordingly, we descend into the merkle root’s left child and look at the next flag for instructions.</p>
<div class="figure align-center" id="id3">
<img alt="Parsing A MerkleBlock" src="../_images/en-merkleblock-parsing-003.svg" /><p class="caption"><span class="caption-text">Parsing A MerkleBlock</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<p>The next flag in the example is a 0 and this is also a non-TXID node, so we apply the first hash from the <a class="reference external" href="/en/developer-reference#merkleblock">“merkleblock” message</a> to this node. We also don’t process any child nodes—according to the peer which created the <a class="reference external" href="/en/developer-reference#merkleblock">“merkleblock” message</a>, none of those nodes will lead to TXIDs of transactions that match our filter, so we don’t need them. We go back up to the merkle root and then descend into its right child and look at the next (third) flag for instructions.</p>
<div class="figure align-center" id="id4">
<img alt="Parsing A MerkleBlock" src="../_images/en-merkleblock-parsing-004.svg" /><p class="caption"><span class="caption-text">Parsing A MerkleBlock</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
<p>The third flag in the example is another 1 on another non-TXID node, so we descend into its left child.</p>
<div class="figure align-center" id="id5">
<img alt="Parsing A MerkleBlock" src="../_images/en-merkleblock-parsing-005.svg" /><p class="caption"><span class="caption-text">Parsing A MerkleBlock</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
<p>The fourth flag is also a 1 on another non-TXID node, so we descend again—we will always continue descending until we reach a TXID node or a non-TXID node with a 0 flag (or we finish filling out the tree).</p>
<div class="figure align-center" id="id6">
<img alt="Parsing A MerkleBlock" src="../_images/en-merkleblock-parsing-006.svg" /><p class="caption"><span class="caption-text">Parsing A MerkleBlock</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</div>
<p>Finally, on the fifth flag in the example (a 1), we reach a TXID node. The 1 flag indicates this TXID’s transaction matches our filter and that we should take the next (second) hash and use it as this node’s TXID.</p>
<div class="figure align-center" id="id7">
<img alt="Parsing A MerkleBlock" src="../_images/en-merkleblock-parsing-007.svg" /><p class="caption"><span class="caption-text">Parsing A MerkleBlock</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</div>
<p>The sixth flag also applies to a TXID, but it’s a 0 flag, so this TXID’s transaction doesn’t match our filter; still, we take the next (third) hash and use it as this node’s TXID.</p>
<div class="figure align-center" id="id8">
<img alt="Parsing A MerkleBlock" src="../_images/en-merkleblock-parsing-008.svg" /><p class="caption"><span class="caption-text">Parsing A MerkleBlock</span><a class="headerlink" href="#id8" title="Permalink to this image">¶</a></p>
</div>
<p>We now have enough information to compute the hash for the fourth node we encountered—it’s the hash of the concatenated hashes of the two TXIDs we filled out.</p>
<div class="figure align-center" id="id9">
<img alt="Parsing A MerkleBlock" src="../_images/en-merkleblock-parsing-009.svg" /><p class="caption"><span class="caption-text">Parsing A MerkleBlock</span><a class="headerlink" href="#id9" title="Permalink to this image">¶</a></p>
</div>
<p>Moving to the right child of the third node we encountered, we fill it out using the seventh flag and final hash—and discover there are no more child nodes to process.</p>
<div class="figure align-center" id="id10">
<img alt="Parsing A MerkleBlock" src="../_images/en-merkleblock-parsing-011.svg" /><p class="caption"><span class="caption-text">Parsing A MerkleBlock</span><a class="headerlink" href="#id10" title="Permalink to this image">¶</a></p>
</div>
<p>We hash as appropriate to fill out the tree. Note that the eighth flag is not used—this is acceptable as it was required to pad out a flag byte.</p>
<p>The final steps would be to ensure the computed merkle root is identical to the merkle root in the header and check the other steps of the parsing checklist in the <a class="reference external" href="/en/developer-reference#merkleblock">“merkleblock” message</a> section.</p>
</div>
</div>


          </div>
        </div>
      </div>
    </div>
      <div class="clearer"></div>
      </div>
    </div>
<footer class="footer d-flex justify-content-between flex-wrap">
    <div class="copyright">
        <div>&copy; Copyright 2019 Bitcoin Developer Documentation.</div>
      <div>Generated by <a href="http://sphinx.pocoo.org/">Sphinx</a> 2.0.1 using <a href="https://github.com/myyasuda/sphinxbootstrap4theme">sphinxbootstrap4theme</a> 0.6.0.</div>
    </div>
    <div>
        <a href="#" class="btn btn-primary btn-sm" role="botton">Back to top</a>
    </div>
</footer>
  </body>
</html>